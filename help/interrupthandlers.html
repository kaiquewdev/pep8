<!DOCTYPE HTML PUBLIC "-//W3C/DTD HTML 4.01//EN">

<html>
<head>
 <title> Pep/8: Interrupt Handlers Documentation </title>
  <style type="text/css" media="all">
   code { font-family:Courier; font-size:11pt }
   pre { font-family:Courier; font-size:11pt }
   h4 { margin-bottom: 0; border-bottom-width: 0; padding-bottom: 0; }
  </style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#000033" alink="#0066FF">
<center>
<table bgcolor="#6699CC" width="100%" cellpadding="2" cellspacing="0" border="0"><tr><td>
<p align="center">
<font FACE="Geneva,Helvetica,Arial" size="3">
Writing Trap Handlers
</font></td></tr></table></center>
<p>
Reference: <i>Computer Systems</i>, Chapter 8.
<p>
To modify the operating system for the problems in Chapter 8 of the text is a six-step process.
<p>
<h4>Step 1.</h4>
Decide on your mnemonic for your new instruction.
It will replace one of <code>NOP0</code>, <code>NOP1</code>, <code>NOP2</code>, <code>NOP3</code>,
<code>NOP</code>, <code>DECI</code>, <code>DECO</code>, or <code>STRO</code>.
Select the menu option System->Redefine Mnemonics to change the mnemonics of one of the instructions.
The dialog box requires you to enter a mnemonic and its allowed addressing modes if it is nonunary.
For example, change the mnemonic for the unary instruction <code>NOP0</code> to <code>ECHO</code>.
<p>
<i>Insert screen shot here of Redefine Mnemonics with NOP0 changed to ECHO.</i>
<p>
<h4>Step 2.</h4>
In this Help system in the pane on the left, select Pep/8 Operating System, and then click the Copy to Source button.
The default operating system will be copied to the Source Code pane.
<p>
<i>Insert screen shots here of Pep/8 OS selected and then copied to Source Code pane.</i>
<p>
<h4>Step 3.</h4>
Modify the trap handler part of the operating system to implement your new instruction.
As an example, here is the original NOP0 trap handler.
<p>
<i>Insert screen shot here of this fragment from Pep/8 OS.</i>
<p>
<pre>
;******* Opcode 0x24
;The NOP0 instruction.
opcode24:RET0
</pre>
And here is how you would modify it to implement the new <code>ECHO</code> instruction in place of <code>NOP0</code>.
<p>
<i>Insert screen shot here of this fragment from modified Pep/8 OS.</i>
<p>
<pre>
;******* Opcode 0x24
;The ECHO instruction.
opcode24:CHARI byteBuff,d
         CHARO byteBuff,d
         RET0
</pre>
CAUTION: You cannot use any trap instructions in your trap handler.
<p>
<h4>Step 4.</h4>
Select System->Assemble/Install New OS to assemble and install the reprogrammed operating system.
<p>
<i>Insert screen shot here of System->Assemble/Install New OS.</i>
<p>
You can save your modified operating system as a <code>.pep</code> file as you would any other Pep/8 assembly language program.
<p>
<h4>Step 5.</h4>
Write an assembly language program to test your new instruction with the new mnemonic.
The assembler should recognize the new mnemonic and generate the appropriate object code.
For example, your test program might be the following.
<p>
<i>Insert screen shot here of the following code in the Source Code pane.</i>
<p>
<pre>
ECHO
STOP
.END
</pre>
<p>
<h4>Step 6.</h4>
Load and execute your program assembled in step 5.
In this example, whatever character is placed in the Input pane should be echoed in the output pane.
<p>
<i>Insert screen shot here of the Batch I/O panes with a single character, P, in the input and output panes.</i>
<p>

</body>
</html>
